<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2025-02-20 Thu 16:34 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>MNESIA</title>
<meta name="author" content="Marcos Benevides" />
<meta name="generator" content="Org Mode" />
<link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
<!-- syntax highlighting -->
<link rel="stylesheet" href="https://unpkg.com/@highlightjs/cdn-assets@11.9.0/styles/default.min.css">
<script src="https://unpkg.com/@highlightjs/cdn-assets@11.9.0/highlight.min.js"></script>
<script src="https://unpkg.com/@highlightjs/cdn-assets@11.9.0/languages/erlang.min.js"></script>
<script src="https://unpkg.com/@highlightjs/cdn-assets@11.9.0/languages/fsharp.min.js"></script>
<script src="https://unpkg.com/@highlightjs/cdn-assets@11.9.0/languages/nix.min.js"></script>
<script src="https://unpkg.com/@highlightjs/cdn-assets@11.9.0/languages/yaml.min.js"></script>
<!-- D3.js for the Org-roam graph -->
<script type="text/javascript" src ="https://d3js.org/d3.v7.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.9.0/d3.min.js"></script>
<!-- For LaTeX -->
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<link href="https://schonfinkel.github.io/static/css/main.css" rel="stylesheet">
<script>
  MathJax = {
    tex: {
      displayMath: [['\\[', '\\]'], ['$$', '$$']],  // block
      inlineMath: [['\\(', '\\)']]                  // inline
    }
  };
</script>
</head>
<body>
<header id="preamble" class="status">
<nav>
  <img
    src="https://schonfinkel.github.io/static/img/logo.png"
    alt="logo"
    width="128"
    height="128"
  />
  <div>
    <h3>"Writing is nothing more than a guided dream."</h3>
  </div>
  <ul>
    <li><a href="https://schonfinkel.github.io/index.html">Home</a></li>
    <li><a href="https://schonfinkel.github.io/blog.html">Blog</a></li>
    <li><a href="https://schonfinkel.github.io/notes.html">Notes</a></li>
    <li><a href="https://schonfinkel.github.io/static/cv.pdf">CV</a></li>
    <li><a href="https://schonfinkel.github.io/static/blogroll.xml">BlogRoll</a></li>
    <li><a href="https://schonfinkel.github.io/rss.xml"><i class='bx bx-rss'></i></a></li>
  </ul>
</nav>
</header>
<main id="content" class="content">
<header>
<h1 class="title">MNESIA</h1>
</header><p>
Mnesia is a database management system (DBMS) that comes with <a href="20240619114451-erlang.html#ID-de7d0e94-618f-4982-b3e5-8806d88cad5d">Erlang</a>. It uses
the <a href="20241010093430-erlang_term_storage.html#ID-37c6ea44-0c80-4c57-a36e-98d37e8a3413">Erlang Term Storage</a> and DETS underneath, but provides many more features
than those components.
</p>
<div id="outline-container-org3140bac" class="outline-2">
<h2 id="org3140bac">Creating the initial Database</h2>
<div class="outline-text-2" id="text-org3140bac">
<p>
During the course of creating this database, you’ll do the following:
</p>

<ol class="org-ol">
<li><p>
Create a Schema
</p>
<div class="org-src-container">
<pre class="src src-erlang">      mnesia:create_schema([node()])
</pre>
</div></li>
<li><p>
Initialize MNESIA
</p>
<div class="org-src-container">
<pre class="src src-erlang">      mnesia:start()
</pre>
</div></li>
<li><p>
Create the DB Tables
</p>
<div class="org-src-container">
<pre class="src src-erlang">      mnesia:create_table(record_name, [{attributes, record_info(fields, record_name)}])
</pre>
</div></li>
<li>Populate Tables</li>
</ol>

<blockquote>
<p>
By default, Mnesia will store your table in RAM only (<code>ram_copies</code>) on the current
node. This is speedy, but it means the data vanishes if the node crashes. If you
specify <code>disc_copies</code> (note the spelling), Mnesia will keep a copy of the database
on disk, but still use RAM for speed. You can also specify <code>disc_only_copies</code>,
which will be slow. (&#x2026;) . By combining these options and (eventually) multiple
nodes, you should be able to create fast and resilient
systems. (<a href="#citeproc_bib_item_2">Laurent 2017, 152</a>)
</p>
</blockquote>

<blockquote>
<p>
Your interactions with Mnesia should be contained in transactions, especially
when your database is shared across multiple nodes. The main <code>mnesia:write</code>,
<code>mnesia:read</code>, and <code>mnesia:delete</code> methods work only within transactions,
period. (<a href="#citeproc_bib_item_2">Laurent 2017, 155</a>)
</p>
</blockquote>
</div>
</div>
<div id="outline-container-org4df936c" class="outline-2">
<h2 id="org4df936c">Queries</h2>
<div class="outline-text-2" id="text-org4df936c">
<ul class="org-ul">
<li>Selecting All Data in a Table:</li>
</ul>

<div class="org-src-container">
<pre class="src src-erlang">  %% sql equivalent
  %% select * from &lt;table&gt;
  select_all(from) -&gt; do(qlc:q([x || x &lt;- mnesia:table(from)]));
</pre>
</div>

<ul class="org-ul">
<li>Joins</li>
</ul>
</div>
<div id="outline-container-org8a25e5b" class="outline-3">
<h3 id="org8a25e5b">Transactions</h3>
<div class="outline-text-3" id="text-org8a25e5b">
<blockquote>
<p>
This is exactly the guarantee that <code>mnesia:transaction/1</code> provides. Either all the
reads and writes to the tables in the database within a particular transaction
succeed, or none of them does. If none of them does, the transaction is said to
fail. If the transaction fails, no changes will be made to the database.
</p>

<p>
The strategy that Mnesia uses for this is a form of pessimistic
locking. Whenever the Mnesia transaction manager accesses a table, it tries to
lock the record or the entire table depending upon the context. If it detects
that this might lead to deadlock, it immediately aborts the transaction and
undoes any changes it has made. (<a href="#citeproc_bib_item_1">Armstrong 2013, 327</a>)
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-erlang">something(...) -&gt;
  F = fun() -&gt;
    % To add a Row
    mnesia:write(Row)
    % or delete it
    mnesia:delete(Oid)
    % ... or ...
    qlc:e(Q)
    end,
  mnesia:transaction(F).
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orge1801d3" class="outline-2">
<h2 id="orge1801d3">References:</h2>
<div class="outline-text-2" id="text-orge1801d3">
<style>.csl-entry{text-indent: -1.5em; margin-left: 1.5em;}</style><div class="csl-bib-body">
  <div class="csl-entry"><a id="citeproc_bib_item_1"></a>Armstrong, Joe. 2013. “Programming Erlang: Software for a Concurrent World.”</div>
  <div class="csl-entry"><a id="citeproc_bib_item_2"></a>Laurent, Simon St. 2017. <i>Introducing Erlang: Getting Started in Functional Programming</i>. O’Reilly Media, Inc.</div>
</div>
</div>
</div>
<div id="outline-container-org35e0abe" class="outline-2">
<h2 id="org35e0abe">Backlinks:</h2>
<div class="outline-text-2" id="text-org35e0abe">
<ul class="org-ul">
<li><a href="./20240928181517-otp.html">OTP</a></li>
</ul>
</div>
</div>
</main>
<footer id="postamble" class="status">
<footer>
  </br>
  <p>
  Built with <a href="https://orgmode.org/">Orgmode</a>, <a href="https://www.gnu.org/software/emacs/">Emacs</a> and <a href="https://nixos.org/">Nix</a>, source code availiable <a href="https://github.com/schonfinkel/schonfinkel.github.io">here</a>.
  </p>
</footer>
</footer>
</body>
</html>
