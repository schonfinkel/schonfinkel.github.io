<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2025-10-25 Sat 01:36 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Error Handling in Erlang</title>
<meta name="author" content="Marcos Benevides" />
<meta name="generator" content="Org Mode" />
<link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
<!-- syntax highlighting -->
<link rel="stylesheet" href="https://unpkg.com/@highlightjs/cdn-assets@11.9.0/styles/default.min.css">
<script src="https://unpkg.com/@highlightjs/cdn-assets@11.9.0/highlight.min.js"></script>
<script src="https://unpkg.com/@highlightjs/cdn-assets@11.9.0/languages/erlang.min.js"></script>
<script src="https://unpkg.com/@highlightjs/cdn-assets@11.9.0/languages/fsharp.min.js"></script>
<script src="https://unpkg.com/@highlightjs/cdn-assets@11.9.0/languages/nix.min.js"></script>
<script src="https://unpkg.com/@highlightjs/cdn-assets@11.9.0/languages/yaml.min.js"></script>
<!-- D3.js for the Org-roam graph -->
<script type="text/javascript" src ="https://d3js.org/d3.v7.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.9.0/d3.min.js"></script>
<!-- For LaTeX -->
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/tex-mml-chtml.js" defer></script>
<link href="https://schonfinkel.github.io/static/css/main.css" rel="stylesheet">
<script>
  MathJax = {
    tex: {
      displayMath: [['\\[', '\\]'], ['$$', '$$']],
      inlineMath: [['\\(', '\\)']]
    }
  };
</script>
</head>
<body>
<header id="preamble" class="status">
<nav>
  <img
    src="https://schonfinkel.github.io/static/img/logo.png"
    alt="logo"
    width="128"
    height="128"
  />
  <div>
    <h3>"Writing is nothing more than a guided dream."</h3>
  </div>
  <ul>
    <li><a href="https://schonfinkel.github.io/index.html">Home</a></li>
    <li><a href="https://schonfinkel.github.io/blog.html">Blog</a></li>
    <li><a href="https://schonfinkel.github.io/notes.html">Notes</a></li>
    <li><a href="https://schonfinkel.github.io/static/cv.pdf">Resume</a></li>
    <li><a href="https://schonfinkel.github.io/static/blogroll.xml">BlogRoll</a></li>
    <li><a href="https://schonfinkel.github.io/rss.xml"><i class='bx bx-rss'></i></a></li>
  </ul>
</nav>
</header>
<main id="content" class="content">
<header>
<h1 class="title">Error Handling in Erlang</h1>
</header><blockquote>
<p>
In <a href="20240619114451-erlang.html#ID-de7d0e94-618f-4982-b3e5-8806d88cad5d">Erlang</a> we do exactly the opposite. We build our applications in two parts: a
part that solves the problem and a part that corrects errors if they have
occurred.
</p>

<p>
The part that solves the problem is written with as little defensive code as
possible; we assume that all arguments to functions are correct and the programs
will execute without errors.
</p>

<p>
The part that corrects errors is often generic, so the same error-correcting
code can be used for many different applications. (<a href="#citeproc_bib_item_1">Armstrong 2013, 201</a>)
</p>
</blockquote>
<div id="outline-container-org95a777d" class="outline-2">
<h2 id="org95a777d">Process Types</h2>
<div class="outline-text-2" id="text-org95a777d">
<p>
There are two types of processes: <b>normal processes</b> and <b>system processes</b>. <code>spawn</code>
(see <a href="20240930224229-concurrent_erlang.html#ID-63607e63-4428-4578-bf2a-12a49649b49c">Concurrent Erlang</a>) creates a normal process. A normal process can become a
system process by evaluating the BIF <code>process_flag(trap_exit, true)</code>.
</p>

<blockquote>
<p>
If your process is set to trap exits, through a call to <code>process_flag(trap_exit,
true)</code>, these error reports arrive as messages, rather than just killing your
process. (<a href="#citeproc_bib_item_3">Laurent 2017, 100</a>)
</p>
</blockquote>

<blockquote>
<p>
Exit signals can be trapped by calling the <code>process_flag(trap_exit, true)</code>
function. This converts exit signals into messages of the form <code>{'EXIT', Pid,
Reason}</code>, where <code>Pid</code> is the process identifier of the process that has died and
Reason is the reason it has terminated. (<a href="#citeproc_bib_item_2">Cesarini and Vinoski 2016, 36</a>)
</p>
</blockquote>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Reason</th>
<th scope="col" class="org-left">Trapping Exits</th>
<th scope="col" class="org-left">Not Trapping Exits</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>normal</code></td>
<td class="org-left"><code>{'EXIT', Pid, normal}</code></td>
<td class="org-left">Nothing happens</td>
</tr>

<tr>
<td class="org-left"><code>kill</code></td>
<td class="org-left">Terminates with reason <code>killed</code></td>
<td class="org-left">Terminates with reason <code>killed</code></td>
</tr>

<tr>
<td class="org-left"><code>Other</code></td>
<td class="org-left"><code>{'EXIT', Pid, Other}</code></td>
<td class="org-left">Terminates with reason <code>Other</code></td>
</tr>
</tbody>
</table>
</div>
<div id="outline-container-orgf7a00a9" class="outline-3">
<h3 id="orgf7a00a9">Propagation Semantics</h3>
<div class="outline-text-3" id="text-orgf7a00a9">
<ul class="org-ul">
<li>Processes can trap <code>exit</code> signals by calling the BIF <code>process_flag(trap_exit, true)</code>.</li>
<li>Once trapped, the errors are saved in the mailbox.</li>
</ul>


<figure id="org86a389d">
<img src="../static/img/notes/erlang_error_trapping.png" alt="erlang_error_trapping.png">

</figure>

<p>
<code>Pid2</code> functions as a firewall, stopping errors from propagating to other processes in the system.
</p>
</div>
</div>
</div>
<div id="outline-container-org4f53844" class="outline-2">
<h2 id="org4f53844">Link</h2>
<div class="outline-text-2" id="text-org4f53844">
<p>
Linking processes can be thought as an extension of the error handling presented
when dealing with <a href="20240924122449-sequential_erlang.html#ID-f0da3356-3797-4ddc-8306-cd333f159754">Sequential Erlang</a>. We can, if necessary, catch exceptions
early in the sequential code, that still won't make our application fault
tolerant.
</p>

<blockquote>
<p>
For one process to observe another, we must create a <code>link</code> or <code>monitor</code> between the
processes. If the linked or monitored processes dies, the observing process is
informed.
</p>

<p>
Observing processes work transparently across machine boundaries, so a
process running on one machine can monitor the behavior of a process run-
ning on a different machine. This is the basis for programming fault-tolerant
systems. (<a href="#citeproc_bib_item_1">Armstrong 2013, 200</a>)
</p>
</blockquote>

<p>
To create links, we call the primitive <code>link(Pid)</code>, which creates a link between the
calling process and <code>Pid</code>. So, if <code>Pid1</code> calls <code>link(Pid2)</code>, a link is created between <code>Pid1</code> and
<code>Pid2</code>.
</p>

<div class="org-src-container">
<pre class="src src-erlang">  Pid1 = link(Pid2)
</pre>
</div>

<ul class="org-ul">
<li><code>link/1</code> creates a bi-directional link between the process calling the BIF (<code>Pid1</code>) and
the process linked (<code>Pid2</code>).</li>
<li><code>spawn_link/3</code> will yield the same result as <code>spawn/3</code> followed by <code>link/1</code>, only that
will do so atomically.</li>
<li><code>unlink/1</code> removes the link to <code>Pid</code>.</li>
</ul>


<figure id="org2050d66">
<img src="../static/img/notes/erlang_process_link.png" alt="erlang_process_link.png">

</figure>
</div>
<div id="outline-container-orgd20ebf7" class="outline-3">
<h3 id="orgd20ebf7">Link Set</h3>
<div class="outline-text-3" id="text-orgd20ebf7">
<p>
The link set of a process <code>P</code> is the set of processes that are linked to <code>P</code>.
</p>


<figure id="orgbc453b8">
<img src="../static/img/notes/erlang_link_set.png" alt="erlang_link_set.png">

</figure>
</div>
</div>
<div id="outline-container-org710d47a" class="outline-3">
<h3 id="org710d47a">Groups of Processes That All Die Together</h3>
<div class="outline-text-3" id="text-org710d47a">
<p>
In the previous example, if a single process from the Link Set fails, all the
processes from the Set also fail in cascate. Ultimately, the error signals
propagate to all the linked processes, and the entire group of linked processes
dies.
</p>


<figure id="orgd4ec259">
<img src="../static/img/notes/erlang_link_set_cascade.png" alt="erlang_link_set_cascade.png">

</figure>

<blockquote>
<p>
When an Erlang process fails, it sends an explanation to other processes that
are linked to it in the form of a tuple. The tuple contains the atom <code>EXIT</code>, the
<code>Pid</code> of the failed process, and the error as a complex tuple. (<a href="#citeproc_bib_item_3">Laurent 2017, 100</a>)
</p>
</blockquote>
</div>
</div>
<div id="outline-container-org6deb73b" class="outline-3">
<h3 id="org6deb73b">Exit Signals</h3>
<div class="outline-text-3" id="text-org6deb73b">
<ul class="org-ul">
<li>A process termination can be <b>normal</b> or <b>abnormal</b>.
<ul class="org-ul">
<li><b>Normal</b>: When there is no more code to execute.</li>
<li><b>Abnormal</b>: Initiated in case of a runtime error, receiving an exit signal
(without proper trapping), or by calling the <code>exit</code> BIFs.</li>
</ul></li>

<li><p>
When a process terminates, it sends a signal to all process its linked to. The
exit signal will contain the following information:
</p>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Field</th>
<th scope="col" class="org-left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><b>Sender Identifier</b></td>
<td class="org-left">The process or port identifier of the process or port that terminated.</td>
</tr>

<tr>
<td class="org-left"><b>Receiver Identifier</b></td>
<td class="org-left">The process or port identifier of the process or port which the exit signal is sent to.</td>
</tr>

<tr>
<td class="org-left">The <code>link</code> flag</td>
<td class="org-left">This flag will be set indicating that the exit signal was sent due to a link.</td>
</tr>

<tr>
<td class="org-left"><code>exit</code> reason</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table></li>
</ul>


<figure id="org222c914">
<img src="../static/img/notes/erlang_error_exit_signals.png" alt="erlang_error_exit_signals.png">

</figure>
</div>
</div>
</div>
<div id="outline-container-orgc446d91" class="outline-2">
<h2 id="orgc446d91">Monitors</h2>
<div class="outline-text-2" id="text-orgc446d91">
<p>
Monitors are similar to links but with several significant differences.
</p>

<ul class="org-ul">
<li>Monitors are unidirectional.</li>
<li>Monitors have an identity given by an Erlang reference, which is a unique value returned by the call to <code>erlang:monitor/2</code>.</li>
<li>A process <code>Pid2</code> can monitor another process <code>Pid1</code> by calling the BIF <code>erlang:monitor(process, Pid2)</code>.</li>
</ul>


<figure id="org5fa198e">
<img src="../static/img/notes/erlang_monitor.png" alt="erlang_monitor.png">

</figure>

<ul class="org-ul">
<li>When a monitored process dies, a "down" message (not an <code>exit</code> signal) is sent
to the monitoring process.</li>
<li>Attempting to monitor a nonexistent process results in a <code>{'DOWN', Reference,
  process, Pid, Reason}</code> message with reason <code>noproc</code>.</li>
</ul>


<figure id="org76f3071">
<img src="../static/img/notes/erlang_monitor_error.png" alt="erlang_monitor_error.png">

</figure>
</div>
</div>
<div id="outline-container-org28eaf1b" class="outline-2">
<h2 id="org28eaf1b">References:</h2>
<div class="outline-text-2" id="text-org28eaf1b">
<style>.csl-entry{text-indent: -1.5em; margin-left: 1.5em;}</style><div class="csl-bib-body">
  <div class="csl-entry"><a id="citeproc_bib_item_1"></a>Armstrong, Joe. 2013. “Programming Erlang: Software for a Concurrent World.”</div>
  <div class="csl-entry"><a id="citeproc_bib_item_2"></a>Cesarini, Francesco, and Steve Vinoski. 2016. <i>Designing for Scalability with Erlang/Otp: Implement Robust, Fault-Tolerant Systems</i>. O’Reilly Media, Inc.</div>
  <div class="csl-entry"><a id="citeproc_bib_item_3"></a>Laurent, Simon St. 2017. <i>Introducing Erlang: Getting Started in Functional Programming</i>. O’Reilly Media, Inc.</div>
</div>
</div>
</div>
</main>
<footer id="postamble" class="status">
<footer>
  </br>
  <p>
  Built with <a href="https://orgmode.org/">Orgmode</a>, <a href="https://www.gnu.org/software/emacs/">Emacs</a> and <a href="https://nixos.org/">Nix</a>, source code availiable <a href="https://github.com/schonfinkel/schonfinkel.github.io">here</a>.
  </p>
</footer>
</footer>
</body>
</html>
