<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2024-12-26 Thu 02:19 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Error Handling in Erlang</title>
<meta name="author" content="Marcos Benevides" />
<meta name="generator" content="Org Mode" />
<style type="text/css">
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
<script type="text/javascript" src ="https://d3js.org/d3.v7.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.9.0/d3.min.js"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<link href="https://schonfinkel.github.io//css/main.css" rel="stylesheet">
<script>
  MathJax = {
    tex: {
      displayMath: [['\\[', '\\]'], ['$$', '$$']],  // block
      inlineMath: [['\\(', '\\)']]                  // inline
    }
  };
</script>
</head>
<body>
<header id="preamble" class="status">
<nav>
  <img
    src="https://schonfinkel.github.io//img/logo.png"
    alt="logo"
    width="128"
    height="128"
  />
  <div>
    <h3>"Writing is nothing more than a guided dream."</h3>
  </div>
  <ul>
    <li><a href="https://schonfinkel.github.io//index.html">Home</a></li>
    <li><a href="https://schonfinkel.github.io//blog.html">Blog</a></li>
    <li><a href="https://schonfinkel.github.io//notes.html">Notes</a></li>
    <li><a href="https://schonfinkel.github.io//blogroll.html">BlogRoll</a></li>
  </ul>
</nav>
</header>
<main id="content" class="content">
<header>
<h1 class="title">Error Handling in Erlang</h1>
</header><blockquote>
<p>
In <a href="20240619114451-erlang.html#ID-de7d0e94-618f-4982-b3e5-8806d88cad5d">Erlang</a> we do exactly the opposite. We build our applications in two parts: a
part that solves the problem and a part that corrects errors if they have
occurred.
</p>

<p>
The part that solves the problem is written with as little defensive code as
possible; we assume that all arguments to functions are correct and the programs
will execute without errors.
</p>

<p>
The part that corrects errors is often generic, so the same error-correcting
code can be used for many different applications. (<a href="#citeproc_bib_item_1">Armstrong 2013, 201</a>)
</p>
</blockquote>
<div id="outline-container-org2686942" class="outline-2">
<h2 id="org2686942">Error Handling Semantics</h2>
<div class="outline-text-2" id="text-org2686942">
</div>
<div id="outline-container-org659f3ed" class="outline-3">
<h3 id="org659f3ed">Processes</h3>
<div class="outline-text-3" id="text-org659f3ed">
<p>
There are two types of processes: <b>normal processes</b> and <b>system processes</b>. <code>spawn</code>
(see <a href="20240930224229-concurrent_erlang.html#ID-63607e63-4428-4578-bf2a-12a49649b49c">Concurrent Erlang</a>) creates a normal process. A normal process can become a
system process by evaluating the BIF <code>process_flag(trap_exit, true)</code>.
</p>
</div>
</div>
<div id="outline-container-org2ae71ad" class="outline-3">
<h3 id="org2ae71ad">Link</h3>
<div class="outline-text-3" id="text-org2ae71ad">
<p>
Linking processes can be thought as an extension of the error handling presented
when dealing with <a href="20240924122449-sequential_erlang.html#ID-f0da3356-3797-4ddc-8306-cd333f159754">Sequential Erlang</a>. We can, if necessary, catch exceptions
early in the sequential code, that still won't make our application fault
tolerant.
</p>

<blockquote>
<p>
For one process to observe another, we must create a <code>link</code> or <code>monitor</code> between the
processes. If the linked or monitored processes dies, the observing process is
informed.
</p>

<p>
Observing processes work transparently across machine boundaries, so a
process running on one machine can monitor the behavior of a process run-
ning on a different machine. This is the basis for programming fault-tolerant
systems. (<a href="#citeproc_bib_item_1">Armstrong 2013, 200</a>)
</p>
</blockquote>

<p>
To create links, we call the primitive <code>link(Pid)</code>, which creates a link between the
calling process and <code>Pid</code>. So, if <code>Pid1</code> calls <code>link(Pid2)</code>, a link is created between <code>Pid1</code> and
<code>Pid2</code>.
</p>

<div class="org-src-container">
<pre class="src src-erlang">  Pid1 = link(Pid2)
</pre>
</div>

<ul class="org-ul">
<li><code>link/1</code> creates a bi-directional link between the process calling the BIF (<code>Pid1</code>) and
the process linked (<code>Pid2</code>).</li>
<li><code>spawn_link/3</code> will yield the same result as <code>spawn/3</code> followed by <code>link/1</code>, only that
will do so atomically.</li>
<li><code>unlink/1</code> removes the link to <code>Pid</code>.</li>
</ul>


<figure id="org22aebdd">
<img src="../static/img/notes/erlang_process_link.png" alt="erlang_process_link.png">

</figure>
</div>
<div id="outline-container-org50e6f29" class="outline-4">
<h4 id="org50e6f29">Link Set</h4>
<div class="outline-text-4" id="text-org50e6f29">
<p>
The link set of a process <code>P</code> is the set of processes that are linked to <code>P</code>.
</p>


<figure id="orgee97dad">
<img src="../static/img/notes/erlang_link_set.png" alt="erlang_link_set.png">

</figure>
</div>
</div>
<div id="outline-container-org560aab5" class="outline-4">
<h4 id="org560aab5">Groups of Processes That All Die Together</h4>
<div class="outline-text-4" id="text-org560aab5">
<p>
In the previous example, if a single process from the Link Set fails, all the
processes from the Set also fail in cascate. Ultimately, the error signals
propagate to all the linked processes, and the entire group of linked processes
dies.
</p>


<figure id="orge05b962">
<img src="../static/img/notes/erlang_link_set_cascade.png" alt="erlang_link_set_cascade.png">

</figure>

<blockquote>
<p>
When an Erlang process fails, it sends an explanation to other processes that
are linked to it in the form of a tuple. The tuple contains the atom <code>EXIT</code>, the
<code>Pid</code> of the failed process, and the error as a complex tuple. (<a href="#citeproc_bib_item_2">Laurent 2017, 100</a>)
</p>
</blockquote>
</div>
</div>
</div>
<div id="outline-container-org1ba954c" class="outline-3">
<h3 id="org1ba954c">Exit Signals</h3>
<div class="outline-text-3" id="text-org1ba954c">
<ul class="org-ul">
<li>A process can termination can be <b>normal</b> or <b>abnormal</b>.
<ul class="org-ul">
<li><b>Normal</b>: When there is no more code to execute.</li>
<li><b>Abnormal</b>: When runtime errors occur.</li>
</ul></li>
<li><p>
When a process terminates, it sends a signal to all process its linked to. The
exit signal will contain the following information:
</p>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Field</th>
<th scope="col" class="org-left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><b>Sender Identifier</b></td>
<td class="org-left">The process or port identifier of the process or port that terminated.</td>
</tr>

<tr>
<td class="org-left"><b>Receiver Identifier</b></td>
<td class="org-left">The process or port identifier of the process or port which the exit signal is sent to.</td>
</tr>

<tr>
<td class="org-left">The <code>link</code> flag</td>
<td class="org-left">This flag will be set indicating that the exit signal was sent due to a link.</td>
</tr>

<tr>
<td class="org-left"><code>exit</code> reason</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table></li>
</ul>


<figure id="orgc25c4db">
<img src="../static/img/notes/erlang_error_exit_signals.png" alt="erlang_error_exit_signals.png">

</figure>
</div>
</div>
<div id="outline-container-org6119496" class="outline-3">
<h3 id="org6119496">Error Trapping</h3>
<div class="outline-text-3" id="text-org6119496">
<blockquote>
<p>
If your process is set to trap exits, through a call to <code>process_flag(trap_exit,
true)</code>, these error reports arrive as messages, rather than just killing your
process. (<a href="#citeproc_bib_item_2">Laurent 2017, 100</a>)
</p>
</blockquote>
</div>
<div id="outline-container-orgc17303f" class="outline-4">
<h4 id="orgc17303f">Propagation Semantics</h4>
<div class="outline-text-4" id="text-orgc17303f">
<ul class="org-ul">
<li>Processes can trap <code>exit</code> signals by calling the BIF <code>process_flag(trap_exit, true)</code>.</li>
<li>Once trapped, the errors are saved in the mailbox.</li>
</ul>


<figure id="org7bc86af">
<img src="../static/img/notes/erlang_error_trapping.png" alt="erlang_error_trapping.png">

</figure>

<p>
<code>Pid2</code> functions as a firewall, stopping errors from propagating to other processes in the system.
</p>
</div>
</div>
</div>
<div id="outline-container-orga42984a" class="outline-3">
<h3 id="orga42984a">Monitors</h3>
<div class="outline-text-3" id="text-orga42984a">
<p>
Monitors are similar to links but with several significant differences.
</p>

<ul class="org-ul">
<li>Monitors are unidirectional.</li>
</ul>

<p>
A process <code>Pid2</code> can create a monitor for <code>Pid1</code> by calling the BIF
<code>erlang:monitor(process, Pid2)</code>. The function returns a reference <code>Ref</code>.
</p>


<figure id="org06f2bef">
<img src="../static/img/notes/erlang_monitor.png" alt="erlang_monitor.png">

</figure>

<ul class="org-ul">
<li>When a monitored process dies, a "down" message (not an <code>exit</code> signal) is sent
to the monitoring process.</li>
</ul>


<figure id="orgb4ae1e3">
<img src="../static/img/notes/erlang_monitor_error.png" alt="erlang_monitor_error.png">

</figure>

<style>.csl-entry{text-indent: -1.5em; margin-left: 1.5em;}</style><div class="csl-bib-body">
  <div class="csl-entry"><a id="citeproc_bib_item_1"></a>Armstrong, Joe. 2013. “Programming Erlang: Software for a Concurrent World.”</div>
  <div class="csl-entry"><a id="citeproc_bib_item_2"></a>Laurent, Simon St. 2017. <i>Introducing Erlang: Getting Started in Functional Programming</i>. O’Reilly Media, Inc.</div>
</div>
</div>
</div>
</div>
</main>
<footer id="postamble" class="status">
<footer>
  </br>
  <p>
  Built with <a href="https://orgmode.org/">Orgmode</a>, <a href="https://www.gnu.org/software/emacs/">Emacs</a> and <a href="https://nixos.org/">Nix</a>, source code availiable <a href="https://github.com/mtrsk/mtrsk.github.io">here</a>.
  </p>
</footer>
</footer>
</body>
</html>
