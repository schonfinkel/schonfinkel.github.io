<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2025-03-02 Sun 02:23 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Data Types (PostgreSQL)</title>
<meta name="author" content="Marcos Benevides" />
<meta name="generator" content="Org Mode" />
<link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
<!-- syntax highlighting -->
<link rel="stylesheet" href="https://unpkg.com/@highlightjs/cdn-assets@11.9.0/styles/default.min.css">
<script src="https://unpkg.com/@highlightjs/cdn-assets@11.9.0/highlight.min.js"></script>
<script src="https://unpkg.com/@highlightjs/cdn-assets@11.9.0/languages/erlang.min.js"></script>
<script src="https://unpkg.com/@highlightjs/cdn-assets@11.9.0/languages/fsharp.min.js"></script>
<script src="https://unpkg.com/@highlightjs/cdn-assets@11.9.0/languages/nix.min.js"></script>
<script src="https://unpkg.com/@highlightjs/cdn-assets@11.9.0/languages/yaml.min.js"></script>
<!-- D3.js for the Org-roam graph -->
<script type="text/javascript" src ="https://d3js.org/d3.v7.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.9.0/d3.min.js"></script>
<!-- For LaTeX -->
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<link href="https://schonfinkel.github.io/static/css/main.css" rel="stylesheet">
<script>
  MathJax = {
    tex: {
      displayMath: [['\\[', '\\]'], ['$$', '$$']],  // block
      inlineMath: [['\\(', '\\)']]                  // inline
    }
  };
</script>
</head>
<body>
<header id="preamble" class="status">
<nav>
  <img
    src="https://schonfinkel.github.io/static/img/logo.png"
    alt="logo"
    width="128"
    height="128"
  />
  <div>
    <h3>"Writing is nothing more than a guided dream."</h3>
  </div>
  <ul>
    <li><a href="https://schonfinkel.github.io/index.html">Home</a></li>
    <li><a href="https://schonfinkel.github.io/blog.html">Blog</a></li>
    <li><a href="https://schonfinkel.github.io/notes.html">Notes</a></li>
    <li><a href="https://schonfinkel.github.io/static/cv.pdf">CV</a></li>
    <li><a href="https://schonfinkel.github.io/static/blogroll.xml">BlogRoll</a></li>
    <li><a href="https://schonfinkel.github.io/rss.xml"><i class='bx bx-rss'></i></a></li>
  </ul>
</nav>
</header>
<main id="content" class="content">
<header>
<h1 class="title">Data Types (PostgreSQL)</h1>
</header><ul class="org-ul">
<li><a href="20240820100534-postgresql.html#ID-1949c98e-e1c0-474b-b383-c76aa418d583">PostgreSQL</a></li>
</ul>
<div id="outline-container-orgb894f84" class="outline-2">
<h2 id="orgb894f84">Schemas</h2>
</div>

<div id="outline-container-org4deb760" class="outline-2">
<h2 id="org4deb760">Numbers</h2>
<div class="outline-text-2" id="text-org4deb760">
</div>
<div id="outline-container-org811fb6e" class="outline-3">
<h3 id="org811fb6e">Integers</h3>
<div class="outline-text-3" id="text-org811fb6e">
<ul class="org-ul">
<li><code>SMALLINT</code> (also aliased to <code>INT2</code>)</li>
<li><code>INTEGER</code> (aliased as <code>INT4</code>)+</li>
<li><code>BIGINT</code> (aliased as <code>INT8</code>)</li>
</ul>
</div>
</div>
<div id="outline-container-orgbe126fd" class="outline-3">
<h3 id="orgbe126fd">Numeric</h3>
<div class="outline-text-3" id="text-orgbe126fd">
<blockquote>
<p>
NUMERIC(precision, scale)
</p>
</blockquote>

<ul class="org-ul">
<li>Can hold values bigger than <code>BIGINT</code></li>
</ul>
</div>
</div>
<div id="outline-container-org4bd2125" class="outline-3">
<h3 id="org4bd2125">Floating Point</h3>
<div class="outline-text-3" id="text-org4bd2125">
<ul class="org-ul">
<li><code>REAL</code></li>
<li><code>DOUBLE PRECISION</code></li>
</ul>
</div>
</div>
<div id="outline-container-org1c44f89" class="outline-3">
<h3 id="org1c44f89">NaN</h3>
</div>

<div id="outline-container-org8d3b3df" class="outline-3">
<h3 id="org8d3b3df">Infinity</h3>
</div>
</div>
<div id="outline-container-org9ae6378" class="outline-2">
<h2 id="org9ae6378">Constraints</h2>
<div class="outline-text-2" id="text-org9ae6378">
</div>
<div id="outline-container-orge0d1e40" class="outline-3">
<h3 id="orge0d1e40">Check Constraint</h3>
<div class="outline-text-3" id="text-orge0d1e40">
<blockquote>
<p>
A check constraint is the most generic constraint type. It allows you to specify
that the value in a certain column must satisfy a Boolean (truth-value)
expression.
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-sql">  <span style="font-weight: bold;">CREATE</span> <span style="font-weight: bold;">TABLE</span> <span style="font-weight: bold;">purchase_item</span> (
    price <span style="font-weight: bold; text-decoration: underline;">INTEGER</span> <span style="font-weight: bold;">CONSTRAINT</span> positive_price <span style="font-weight: bold;">CHECK</span> (price &gt; 0),
    discount <span style="font-weight: bold; text-decoration: underline;">INTEGER</span> <span style="font-weight: bold;">CONSTRAINT</span> non_negative_discount <span style="font-weight: bold;">CHECK</span> (discount &gt;= 0),
    description TEXT (<span style="font-weight: bold;">LENGTH</span>(description) &lt; 2048)
  );
</pre>
</div>

<p>
You can also apply a <code>CHECK</code> constraint to the entire table and can involve multiple columns.
</p>

<div class="org-src-container">
<pre class="src src-sql">  <span style="font-weight: bold;">CREATE</span> <span style="font-weight: bold;">TABLE</span> <span style="font-weight: bold;">purchase_item</span> (
    price <span style="font-weight: bold; text-decoration: underline;">INTEGER</span> <span style="font-weight: bold;">CONSTRAINT</span> positive_price <span style="font-weight: bold;">CHECK</span> (price &gt; 0),
    discount <span style="font-weight: bold; text-decoration: underline;">INTEGER</span> <span style="font-weight: bold;">CONSTRAINT</span> non_negative_discount <span style="font-weight: bold;">CHECK</span> (discount &gt;= 0),
    description TEXT (<span style="font-weight: bold;">LENGTH</span>(description) &lt; 2048),
    <span style="font-weight: bold;">CHECK</span> (price &gt; discount)
  );
</pre>
</div>
</div>
</div>
<div id="outline-container-orgca42282" class="outline-3">
<h3 id="orgca42282">Unique Constraints</h3>
<div class="outline-text-3" id="text-orgca42282">
<p>
Ensures that the data contained in a column (or in a group of columns) is
unique.
</p>

<div class="org-src-container">
<pre class="src src-sql">  <span style="font-weight: bold;">CREATE</span> <span style="font-weight: bold;">TABLE</span> <span style="font-weight: bold;">products</span> (
    id BIGINT <span style="font-weight: bold;">GENERATED</span> ALWAYS <span style="font-weight: bold;">AS</span> <span style="font-weight: bold;">IDENTITY</span> <span style="font-weight: bold;">PRIMARY</span> <span style="font-weight: bold;">KEY</span>,
    brand TEXT <span style="font-weight: bold;">UNIQUE</span> <span style="font-weight: bold;">NOT</span> <span style="font-weight: bold;">NULL</span>,
    product_no TEXT <span style="font-weight: bold;">UNIQUE</span> <span style="font-weight: bold;">NOT</span> <span style="font-weight: bold;">NULL</span>,
    <span style="font-weight: bold;">name</span> TEXT <span style="font-weight: bold;">NOT</span> <span style="font-weight: bold;">NULL</span>,
  );
  <span style="font-weight: bold; font-style: italic;">-- </span><span style="font-weight: bold; font-style: italic;">or</span>
  <span style="font-weight: bold;">CREATE</span> <span style="font-weight: bold;">TABLE</span> <span style="font-weight: bold;">products</span> (
    id BIGINT <span style="font-weight: bold;">GENERATED</span> ALWAYS <span style="font-weight: bold;">AS</span> <span style="font-weight: bold;">IDENTITY</span> <span style="font-weight: bold;">PRIMARY</span> <span style="font-weight: bold;">KEY</span>,
    brand TEXT <span style="font-weight: bold;">NOT</span> <span style="font-weight: bold;">NULL</span>,
    product_no TEXT <span style="font-weight: bold;">NOT</span> <span style="font-weight: bold;">NULL</span>,
    <span style="font-weight: bold;">name</span> TEXT <span style="font-weight: bold;">NOT</span> <span style="font-weight: bold;">NULL</span>,
    <span style="font-weight: bold;">UNIQUE</span> (brand, product_no)
  );
</pre>
</div>
</div>
</div>
<div id="outline-container-org6c6d275" class="outline-3">
<h3 id="org6c6d275">Exclude Constraints</h3>
<div class="outline-text-3" id="text-org6c6d275">
<div class="org-src-container">
<pre class="src src-sql">  <span style="font-weight: bold;">CREATE</span> EXTENSION IF <span style="font-weight: bold;">NOT</span> <span style="font-weight: bold;">EXISTS</span> btree_gist;
  <span style="font-weight: bold;">CREATE</span> <span style="font-weight: bold;">TABLE</span> <span style="font-weight: bold;">bookings</span> (
    id BIGINT <span style="font-weight: bold;">GENERATED</span> ALWAYS <span style="font-weight: bold;">AS</span> <span style="font-weight: bold;">IDENTITY</span> <span style="font-weight: bold;">PRIMARY</span> <span style="font-weight: bold;">KEY</span>,
    <span style="font-weight: bold; font-style: italic;">-- </span><span style="font-weight: bold; font-style: italic;">TODO: use proper enums for this in real life</span>
    status TEXT <span style="font-weight: bold;">NOT</span> <span style="font-weight: bold;">NULL</span>;
    <span style="font-weight: bold; font-style: italic;">-- </span><span style="font-weight: bold; font-style: italic;">The time the resource will be allocated to someone else</span>
    reservation_period TSRANGE;
    <span style="font-weight: bold; font-style: italic;">-- </span><span style="font-weight: bold; font-style: italic;">For a given booking, there can be no overlaps, unless</span>
    <span style="font-weight: bold; font-style: italic;">-- </span><span style="font-weight: bold; font-style: italic;">the current booking status is set to 'cancelled'.</span>
    EXCLUDE <span style="font-weight: bold;">USING</span> gist (id <span style="font-weight: bold;">WITH</span> =, reservation_period <span style="font-weight: bold;">WITH</span> &amp;&amp;) <span style="font-weight: bold;">WHERE</span> (reservation_status != <span style="font-style: italic;">'cancelled'</span>)
  );
</pre>
</div>
</div>
</div>
<div id="outline-container-orgde341a4" class="outline-3">
<h3 id="orgde341a4">Primary Key Constraint</h3>
</div>

<div id="outline-container-orgf90e41b" class="outline-3">
<h3 id="orgf90e41b">Foreign Key Constraints</h3>
<div class="outline-text-3" id="text-orgf90e41b">
<blockquote>
<p>
A foreign key constraint specifies that the values in a column (or a group of
columns) must match the values appearing in some row of another table. We say
this maintains the referential integrity between two related tables.
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-sql">  <span style="font-weight: bold;">CREATE</span> <span style="font-weight: bold;">TABLE</span> <span style="font-weight: bold;">products</span> (
    id BIGINT <span style="font-weight: bold;">GENERATED</span> ALWAYS <span style="font-weight: bold;">AS</span> <span style="font-weight: bold;">IDENTITY</span> <span style="font-weight: bold;">PRIMARY</span> <span style="font-weight: bold;">KEY</span>,
    brand TEXT <span style="font-weight: bold;">NOT</span> <span style="font-weight: bold;">NULL</span>,
    product_no TEXT <span style="font-weight: bold;">NOT</span> <span style="font-weight: bold;">NULL</span>,
    <span style="font-weight: bold;">name</span> TEXT <span style="font-weight: bold;">NOT</span> <span style="font-weight: bold;">NULL</span>,
    <span style="font-weight: bold;">UNIQUE</span> (brand, product_no)
  );

  <span style="font-weight: bold;">CREATE</span> <span style="font-weight: bold;">TABLE</span> <span style="font-weight: bold;">orders</span> (
    id BIGINT <span style="font-weight: bold;">GENERATED</span> ALWAYS <span style="font-weight: bold;">AS</span> <span style="font-weight: bold;">IDENTITY</span> <span style="font-weight: bold;">PRIMARY</span> <span style="font-weight: bold;">KEY</span>,
    product_id BIGINT <span style="font-weight: bold;">REFERENCES</span> products(id),
    quantity <span style="font-weight: bold; text-decoration: underline;">INTEGER</span> order_must_be_positive <span style="font-weight: bold;">CHECK</span> (quantity &gt; 0)
  );
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orge8c5e76" class="outline-2">
<h2 id="orge8c5e76">Domain Types</h2>
<div class="outline-text-2" id="text-orge8c5e76">
<div class="org-src-container">
<pre class="src src-sql">  <span style="font-weight: bold;">CREATE</span> <span style="font-weight: bold;">DOMAIN</span> us_postal_code <span style="font-weight: bold;">AS</span> TEXT
    <span style="font-weight: bold;">CHECK</span>(<span style="font-weight: bold;">VALUE</span> ~ <span style="font-style: italic;">'^\d{5}$'</span> <span style="font-weight: bold;">OR</span> <span style="font-weight: bold;">VALUE</span> ~ <span style="font-style: italic;">'^\d{5}-\d{4}$'</span>
  );
</pre>
</div>
</div>
</div>
<div id="outline-container-orgb74e03c" class="outline-2">
<h2 id="orgb74e03c">Binary Data</h2>
</div>

<div id="outline-container-org091c11d" class="outline-2">
<h2 id="org091c11d">UUIDs</h2>
</div>

<div id="outline-container-org26e8201" class="outline-2">
<h2 id="org26e8201">Booleans</h2>
</div>

<div id="outline-container-org934bcbc" class="outline-2">
<h2 id="org934bcbc">Enums</h2>
<div class="outline-text-2" id="text-org934bcbc">
<div class="org-src-container">
<pre class="src src-sql">  <span style="font-weight: bold;">CREATE</span> <span style="font-weight: bold;">TYPE</span> <span style="font-weight: bold;">mood</span> <span style="font-weight: bold;">AS</span> ENUM (<span style="font-style: italic;">'sad'</span>, <span style="font-style: italic;">'neutral'</span>, <span style="font-style: italic;">'happy'</span>);

  <span style="font-weight: bold; font-style: italic;">-- </span><span style="font-weight: bold; font-style: italic;">You can also add another value later, and set its position</span>
  <span style="font-weight: bold;">ALTER</span> <span style="font-weight: bold;">TYPE</span> <span style="font-weight: bold;">mood</span> <span style="font-weight: bold;">ADD</span> <span style="font-weight: bold;">VALUE</span> <span style="font-style: italic;">'afraid'</span> <span style="font-weight: bold;">AFTER</span> <span style="font-style: italic;">'sad'</span>;
</pre>
</div>

<p>
Removing a value from an <code>ENUM</code> is tricky, you need to drop the old type and
recreate a new one, making sure all tables default the old value to something else.
</p>

<div class="org-src-container">
<pre class="src src-sql">  <span style="font-weight: bold; font-style: italic;">-- </span><span style="font-weight: bold; font-style: italic;">Always do it inside a transaction</span>
  <span style="font-weight: bold;">BEGIN</span>;

  <span style="font-weight: bold; font-style: italic;">-- </span><span style="font-weight: bold; font-style: italic;">Rename old type</span>
  <span style="font-weight: bold;">ALTER</span> <span style="font-weight: bold;">TYPE</span> <span style="font-weight: bold;">mood</span> RENAME <span style="font-weight: bold;">TO</span> mood_old;

  <span style="font-weight: bold; font-style: italic;">-- </span><span style="font-weight: bold; font-style: italic;">Create a new type</span>
  <span style="font-weight: bold;">CREATE</span> <span style="font-weight: bold;">TYPE</span> <span style="font-weight: bold;">mood</span> <span style="font-weight: bold;">AS</span> ENUM (<span style="font-style: italic;">'sad'</span>, <span style="font-style: italic;">'neutral'</span>, <span style="font-style: italic;">'happy'</span>);

  <span style="font-weight: bold; font-style: italic;">-- </span><span style="font-weight: bold; font-style: italic;">Update any tables that use this type, default old</span>
  <span style="font-weight: bold; font-style: italic;">-- </span><span style="font-weight: bold; font-style: italic;">removed value to something else.</span>
  <span style="font-weight: bold;">UPDATE</span>
    &lt;table_with_enum&gt;
  <span style="font-weight: bold;">SET</span>
    current_mood = <span style="font-style: italic;">'neutral'</span>
  <span style="font-weight: bold;">WHERE</span>
    current_mood <span style="font-weight: bold;">NOT</span> <span style="font-weight: bold;">IN</span> (<span style="font-style: italic;">'sad'</span>, <span style="font-style: italic;">'neutral'</span>, <span style="font-style: italic;">'happy'</span>);

  <span style="font-weight: bold; font-style: italic;">-- </span><span style="font-weight: bold; font-style: italic;">Switch to the new type</span>
  <span style="font-weight: bold;">ALTER</span> <span style="font-weight: bold;">TABLE</span> &lt;table_with_enum&gt;
  <span style="font-weight: bold;">ALTER</span> <span style="font-weight: bold;">COLUMN</span> current_mood
    <span style="font-weight: bold;">TYPE</span> mood <span style="font-weight: bold;">USING</span> mood_old::text::status_enum;

  <span style="font-weight: bold;">COMMIT</span>;
</pre>
</div>
</div>
</div>
<div id="outline-container-orga26c739" class="outline-2">
<h2 id="orga26c739">Timestamps</h2>
<div class="outline-text-2" id="text-orga26c739">
</div>
<div id="outline-container-org53dfe5d" class="outline-3">
<h3 id="org53dfe5d">Built-In Functions</h3>
<div class="outline-text-3" id="text-org53dfe5d">
<ul class="org-ul">
<li><code>to_timestap</code></li>
</ul>
</div>
</div>
<div id="outline-container-org40228a5" class="outline-3">
<h3 id="org40228a5">Setting a DB Timezone</h3>
<div class="outline-text-3" id="text-org40228a5">
<div class="org-src-container">
<pre class="src src-sql">  <span style="font-weight: bold;">SET</span> <span style="font-weight: bold; text-decoration: underline;">TIME</span> <span style="font-weight: bold; text-decoration: underline;">ZONE</span> <span style="font-style: italic;">'UTC'</span>;
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgd479a25" class="outline-2">
<h2 id="orgd479a25">Dates &amp; Time</h2>
<div class="outline-text-2" id="text-orgd479a25">
</div>
<div id="outline-container-orgb57a4ad" class="outline-3">
<h3 id="orgb57a4ad">Magic Constants</h3>
<div class="outline-text-3" id="text-orgb57a4ad">
<ul class="org-ul">
<li><code>CURRENT_DATE</code></li>
<li><code>CURRENT_TIME</code></li>
<li><code>CURRRENT_TIMESTAMP</code></li>
<li><code>LOCALTIME</code></li>
<li><code>LOCALTIMESTAMP</code></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org262ed1e" class="outline-2">
<h2 id="org262ed1e">Intervals</h2>
</div>

<div id="outline-container-org2435a80" class="outline-2">
<h2 id="org2435a80">Serial</h2>
</div>

<div id="outline-container-org6064c0c" class="outline-2">
<h2 id="org6064c0c">Sequences</h2>
<div class="outline-text-2" id="text-org6064c0c">
<div class="org-src-container">
<pre class="src src-sql">  <span style="font-weight: bold;">CREATE</span> <span style="font-weight: bold;">SEQUENCE</span> IF <span style="font-weight: bold;">NOT</span> <span style="font-weight: bold;">EXISTS</span> <span style="font-weight: bold;">some_seq</span>
    <span style="font-weight: bold;">AS</span> BIGINT
    <span style="font-weight: bold;">START</span> <span style="font-weight: bold;">WITH</span> 1
    INCREMENT <span style="font-weight: bold;">BY</span> 1
    MINVALUE 1;
</pre>
</div>

<ul class="org-ul">
<li><code>SELECT NEXTVAL('some_seq');</code></li>
<li><p>
<code>SELECT CURRVAL('some_seq');</code>
</p>

<p>
Outputs the current value of the session, not the global sequence value.
</p></li>

<li><code>SELECT SETVAL('some_seq', 1000);</code></li>
</ul>
</div>
</div>
<div id="outline-container-org654832a" class="outline-2">
<h2 id="org654832a">Identity</h2>
<div class="outline-text-2" id="text-org654832a">
<div class="org-src-container">
<pre class="src src-sql">  <span style="font-weight: bold;">CREATE</span> <span style="font-weight: bold;">TABLE</span> <span style="font-weight: bold;">user</span> (
    id BIGINT <span style="font-weight: bold;">GENERATED</span> ALWAYS <span style="font-weight: bold;">AS</span> <span style="font-weight: bold;">IDENTITY</span> <span style="font-weight: bold;">PRIMARY</span> <span style="font-weight: bold;">KEY</span>,
    ...,
  );

  <span style="font-weight: bold; font-style: italic;">-- </span><span style="font-weight: bold; font-style: italic;">To find out the internal name of the sequence</span>
  <span style="font-weight: bold; font-style: italic;">-- </span><span style="font-weight: bold; font-style: italic;">being used.</span>
  <span style="font-weight: bold;">SELECT</span> pg_get_serial_sequence(<span style="font-style: italic;">'user'</span>, <span style="font-style: italic;">'id'</span>);
</pre>
</div>
</div>
</div>
<div id="outline-container-orgbca3f92" class="outline-2">
<h2 id="orgbca3f92">Network Types</h2>
</div>

<div id="outline-container-org6f272e4" class="outline-2">
<h2 id="org6f272e4">JSON</h2>
<div class="outline-text-2" id="text-org6f272e4">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Type</th>
<th scope="col" class="org-left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>JSON</code></td>
<td class="org-left">Stored as <code>TEXT</code> under the hood</td>
</tr>

<tr>
<td class="org-left"><code>JSONB</code></td>
<td class="org-left">Stored as binary, contains extra metadata to make most queries faster</td>
</tr>
</tbody>
</table>
</div>
<div id="outline-container-orgd9c9040" class="outline-3">
<h3 id="orgd9c9040">Querying JSON</h3>
</div>
</div>
<div id="outline-container-org328f226" class="outline-2">
<h2 id="org328f226">Arrays</h2>
<div class="outline-text-2" id="text-org328f226">
<blockquote>
<p>
PostgreSQL allows columns of a table to be defined as variable-length
multidimensional arrays. Arrays of any built-in or user-defined base type, enum
type, composite type, range type, or domain can be created.
</p>
</blockquote>
</div>
<div id="outline-container-org4e260c2" class="outline-3">
<h3 id="org4e260c2">Declaration</h3>
<div class="outline-text-3" id="text-org4e260c2">
<div class="org-src-container">
<pre class="src src-sql"><span style="font-weight: bold;">CREATE</span> <span style="font-weight: bold;">TABLE</span> <span style="font-weight: bold;">tictactoe</span> (
  squares <span style="font-weight: bold; text-decoration: underline;">INTEGER</span>[3][3]
);
</pre>
</div>

<ul class="org-ul">
<li>Arrays indexes start at 1, not 0.</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org93b9b49" class="outline-2">
<h2 id="org93b9b49">Generated Columns</h2>
<div class="outline-text-2" id="text-org93b9b49">
<blockquote>
<p>
A generated column is a special column that is always computed from other
columns. Thus, it is for columns what a view is for tables.
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-sql">  <span style="font-weight: bold;">CREATE</span> <span style="font-weight: bold;">TABLE</span> <span style="font-weight: bold;">people</span> (
    ...,
    height_cm <span style="font-weight: bold; text-decoration: underline;">numeric</span>,
    <span style="font-weight: bold; font-style: italic;">-- </span><span style="font-weight: bold; font-style: italic;">The keyword STORED must be specified to choose the</span>
    <span style="font-weight: bold; font-style: italic;">-- </span><span style="font-weight: bold; font-style: italic;">stored kind of generated column.</span>
    height_in <span style="font-weight: bold; text-decoration: underline;">numeric</span> <span style="font-weight: bold;">GENERATED</span> ALWAYS <span style="font-weight: bold;">AS</span> (height_cm / 2.54) STORED
  );
</pre>
</div>
</div>
</div>
<div id="outline-container-orgb8d6ce5" class="outline-2">
<h2 id="orgb8d6ce5">Text Search Types</h2>
<div class="outline-text-2" id="text-orgb8d6ce5">
<ul class="org-ul">
<li>A <code>ts_vector</code> value is a sorted list of distinct lexemes.</li>
</ul>

<div class="org-src-container">
<pre class="src src-sql">  &lt;database&gt;#= <span style="font-weight: bold;">SELECT</span> <span style="font-style: italic;">'a fat cat sat on a mat and ate a fat rat'</span>::tsvector;
                      tsvector                      
  <span style="font-weight: bold; font-style: italic;">----------------------------------------------------</span>
  <span style="font-style: italic;">'a'</span> <span style="font-style: italic;">'and'</span> <span style="font-style: italic;">'ate'</span> <span style="font-style: italic;">'cat'</span> <span style="font-style: italic;">'fat'</span> <span style="font-style: italic;">'mat'</span> <span style="font-style: italic;">'on'</span> <span style="font-style: italic;">'rat'</span> <span style="font-style: italic;">'sat'</span>
  &lt;database&gt;#= <span style="font-weight: bold;">SELECT</span> to_tsvector(<span style="font-style: italic;">'a fat cat sat on a mat and ate a fat rat'</span>);
                                  to_tsvector                                  
  <span style="font-weight: bold; font-style: italic;">-------------------------------------------------------------------------------</span>
  <span style="font-style: italic;">'a'</span>:1,6,10 <span style="font-style: italic;">'and'</span>:8 <span style="font-style: italic;">'ate'</span>:9 <span style="font-style: italic;">'cat'</span>:3 <span style="font-style: italic;">'fat'</span>:2,11 <span style="font-style: italic;">'mat'</span>:7 <span style="font-style: italic;">'on'</span>:5 <span style="font-style: italic;">'rat'</span>:12 <span style="font-style: italic;">'sat'</span>:4
  &lt;database&gt;#= <span style="font-weight: bold;">SELECT</span> <span style="font-style: italic;">'The quick brown fox jumps over the lazy dog'</span>::tsvector;
                           tsvector                            
  <span style="font-weight: bold; font-style: italic;">---------------------------------------------------------------</span>
  <span style="font-style: italic;">'The'</span> <span style="font-style: italic;">'brown'</span> <span style="font-style: italic;">'dog'</span> <span style="font-style: italic;">'fox'</span> <span style="font-style: italic;">'jumps'</span> <span style="font-style: italic;">'lazy'</span> <span style="font-style: italic;">'over'</span> <span style="font-style: italic;">'quick'</span> <span style="font-style: italic;">'the'</span>
  &lt;database&gt;#= <span style="font-weight: bold;">SELECT</span> to_tsvector(<span style="font-style: italic;">'The quick brown fox jumps over the lazy dog'</span>);
                                to_tsvector                                
  <span style="font-weight: bold; font-style: italic;">---------------------------------------------------------------------------</span>
  <span style="font-style: italic;">'brown'</span>:3 <span style="font-style: italic;">'dog'</span>:9 <span style="font-style: italic;">'fox'</span>:4 <span style="font-style: italic;">'jumps'</span>:5 <span style="font-style: italic;">'lazy'</span>:8 <span style="font-style: italic;">'over'</span>:6 <span style="font-style: italic;">'quick'</span>:2 <span style="font-style: italic;">'the'</span>:1,7
</pre>
</div>

<ul class="org-ul">
<li>A <code>ts_query</code> can be used to build lexemes and apply then to certain operators.</li>
</ul>

<div class="org-src-container">
<pre class="src src-sql">  &lt;database&gt;#= <span style="font-weight: bold;">SELECT</span> <span style="font-style: italic;">'fat &amp; rat'</span>::tsquery;
      tsquery    
  <span style="font-weight: bold; font-style: italic;">---------------</span>
   <span style="font-style: italic;">'fat'</span> &amp; <span style="font-style: italic;">'rat'</span>
  &lt;database&gt;#= <span style="font-weight: bold;">SELECT</span> to_tsvector(<span style="font-style: italic;">'a fat cat sat on a mat and ate a fat rat'</span>) @@ to_tsquery(<span style="font-style: italic;">'fat | cat'</span>) <span style="font-weight: bold;">as</span> <span style="font-weight: bold;">result</span>;
   <span style="font-weight: bold;">result</span> 
  <span style="font-weight: bold; font-style: italic;">--------</span>
   t
  &lt;database&gt;#= <span style="font-weight: bold;">SELECT</span> to_tsvector(<span style="font-style: italic;">'a fat cat sat on a mat and ate a fat rat'</span>) @@ to_tsquery(<span style="font-style: italic;">'bat | hat'</span>) <span style="font-weight: bold;">as</span> <span style="font-weight: bold;">result</span>;
   <span style="font-weight: bold;">result</span> 
  <span style="font-weight: bold; font-style: italic;">--------</span>
   f
</pre>
</div>

<p>
you can leverage generated columns when creating tables with searchable content.
</p>

<div class="org-src-container">
<pre class="src src-sql">  <span style="font-weight: bold;">CREATE</span> <span style="font-weight: bold;">TABLE</span> <span style="font-weight: bold;">user_comment</span> (
    id BIGINT <span style="font-weight: bold;">GENERATED</span> ALWAYS <span style="font-weight: bold;">AS</span> <span style="font-weight: bold;">IDENTITY</span> <span style="font-weight: bold;">PRIMARY</span> <span style="font-weight: bold;">KEY</span>,
    content TEXT <span style="font-weight: bold;">NOT</span> <span style="font-weight: bold;">NULL</span>,
    search_vector_en TSVECTOR <span style="font-weight: bold;">GENERATED</span> ALWAYS <span style="font-weight: bold;">AS</span> (to_tsvector(<span style="font-style: italic;">'english'</span>, content)) STORED
  );
</pre>
</div>
</div>
</div>
<div id="outline-container-org4085e4d" class="outline-2">
<h2 id="org4085e4d">Bit String</h2>
</div>

<div id="outline-container-org41a7bfa" class="outline-2">
<h2 id="org41a7bfa">Ranges</h2>
<div class="outline-text-2" id="text-org41a7bfa">
<p>
PostgreSQL comes with the following built-in range types:
</p>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Type</th>
<th scope="col" class="org-left">Data Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>int4range</code></td>
<td class="org-left"><code>INTEGER</code></td>
</tr>

<tr>
<td class="org-left"><code>int8range</code></td>
<td class="org-left"><code>BIGINT</code></td>
</tr>

<tr>
<td class="org-left"><code>numrange</code></td>
<td class="org-left"><code>NUMERIC</code></td>
</tr>

<tr>
<td class="org-left"><code>tsrange</code></td>
<td class="org-left"><code>TIMESTAMP</code></td>
</tr>

<tr>
<td class="org-left"><code>tstzrange</code></td>
<td class="org-left"><code>TIMESTAMP WITH TIMEZONE</code></td>
</tr>

<tr>
<td class="org-left"><code>daterange</code></td>
<td class="org-left"><code>DATE</code></td>
</tr>
</tbody>
</table>

<div class="org-src-container">
<pre class="src src-sql">  <span style="font-weight: bold;">CREATE</span> <span style="font-weight: bold;">TABLE</span> <span style="font-weight: bold;">reservation</span> (room <span style="font-weight: bold; text-decoration: underline;">int</span>, during tsrange);
  <span style="font-weight: bold;">INSERT</span> <span style="font-weight: bold;">INTO</span> reservation <span style="font-weight: bold;">VALUES</span>
      (1108, <span style="font-style: italic;">'[2010-01-01 14:30, 2010-01-01 15:30)'</span>);

  <span style="font-weight: bold; font-style: italic;">-- </span><span style="font-weight: bold; font-style: italic;">Containment</span>
  <span style="font-weight: bold;">SELECT</span> int4range(10, 20) @&gt; 3;

  <span style="font-weight: bold; font-style: italic;">-- </span><span style="font-weight: bold; font-style: italic;">Overlaps</span>
  <span style="font-weight: bold;">SELECT</span> numrange(11.1, 22.2) &amp;&amp; numrange(20.0, 30.0);

  <span style="font-weight: bold; font-style: italic;">-- </span><span style="font-weight: bold; font-style: italic;">Extract the upper bound</span>
  <span style="font-weight: bold;">SELECT</span> <span style="font-weight: bold;">upper</span>(int8range(15, 25));

  <span style="font-weight: bold; font-style: italic;">-- </span><span style="font-weight: bold; font-style: italic;">Compute the intersection</span>
  <span style="font-weight: bold;">SELECT</span> int4range(10, 20) * int4range(15, 25);

  <span style="font-weight: bold; font-style: italic;">-- </span><span style="font-weight: bold; font-style: italic;">Is the range empty?</span>
  <span style="font-weight: bold;">SELECT</span> isempty(numrange(1, 5));
</pre>
</div>
</div>
</div>
<div id="outline-container-orgc5ab5c1" class="outline-2">
<h2 id="orgc5ab5c1">Composite Types</h2>
</div>

<div id="outline-container-orge82f843" class="outline-2">
<h2 id="orge82f843">Nulls</h2>
</div>

<div id="outline-container-org6f05fb5" class="outline-2">
<h2 id="org6f05fb5">References:</h2>
<div class="outline-text-2" id="text-org6f05fb5">
<style>.csl-entry{text-indent: -1.5em; margin-left: 1.5em;}</style><div class="csl-bib-body">
</div>
</div>
</div>
</main>
<footer id="postamble" class="status">
<footer>
  </br>
  <p>
  Built with <a href="https://orgmode.org/">Orgmode</a>, <a href="https://www.gnu.org/software/emacs/">Emacs</a> and <a href="https://nixos.org/">Nix</a>, source code availiable <a href="https://github.com/schonfinkel/schonfinkel.github.io">here</a>.
  </p>
</footer>
</footer>
</body>
</html>
