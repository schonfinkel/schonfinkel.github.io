<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2025-09-08 Mon 13:07 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Window Functions (PostgreSQL)</title>
<meta name="author" content="Marcos Benevides" />
<meta name="generator" content="Org Mode" />
<link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
<!-- syntax highlighting -->
<link rel="stylesheet" href="https://unpkg.com/@highlightjs/cdn-assets@11.9.0/styles/default.min.css">
<script src="https://unpkg.com/@highlightjs/cdn-assets@11.9.0/highlight.min.js"></script>
<script src="https://unpkg.com/@highlightjs/cdn-assets@11.9.0/languages/erlang.min.js"></script>
<script src="https://unpkg.com/@highlightjs/cdn-assets@11.9.0/languages/fsharp.min.js"></script>
<script src="https://unpkg.com/@highlightjs/cdn-assets@11.9.0/languages/nix.min.js"></script>
<script src="https://unpkg.com/@highlightjs/cdn-assets@11.9.0/languages/yaml.min.js"></script>
<!-- D3.js for the Org-roam graph -->
<script type="text/javascript" src ="https://d3js.org/d3.v7.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.9.0/d3.min.js"></script>
<!-- For LaTeX -->
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<link href="https://schonfinkel.github.io/static/css/main.css" rel="stylesheet">
<script>
  MathJax = {
    tex: {
      displayMath: [['\\[', '\\]'], ['$$', '$$']],  // block
      inlineMath: [['\\(', '\\)']]                  // inline
    }
  };
</script>
</head>
<body>
<header id="preamble" class="status">
<nav>
  <img
    src="https://schonfinkel.github.io/static/img/logo.png"
    alt="logo"
    width="128"
    height="128"
  />
  <div>
    <h3>"Writing is nothing more than a guided dream."</h3>
  </div>
  <ul>
    <li><a href="https://schonfinkel.github.io/index.html">Home</a></li>
    <li><a href="https://schonfinkel.github.io/blog.html">Blog</a></li>
    <li><a href="https://schonfinkel.github.io/notes.html">Notes</a></li>
    <li><a href="https://schonfinkel.github.io/static/cv.pdf">CV</a></li>
    <li><a href="https://schonfinkel.github.io/static/blogroll.xml">BlogRoll</a></li>
    <li><a href="https://schonfinkel.github.io/rss.xml"><i class='bx bx-rss'></i></a></li>
  </ul>
</nav>
</header>
<main id="content" class="content">
<header>
<h1 class="title">Window Functions (PostgreSQL)</h1>
</header><blockquote>
<p>
A window function performs a calculation across a set of table rows that are
somehow related to the current row. This is comparable to the type of
calculation that can be done with an aggregate function. However, window
functions do not cause rows to become grouped into a single output row like
non-window aggregate calls would. Instead, the rows retain their separate
identities. Behind the scenes, the window function is able to access more than
just the current row of the query result. <sup><a id="fnr.1" class="footref" href="#fn.1" role="doc-backlink">1</a></sup>
</p>
</blockquote>
<div id="outline-container-org081471c" class="outline-2">
<h2 id="org081471c"><code>PARTITION BY</code> and <code>WINDOW</code> clauses</h2>
<div class="outline-text-2" id="text-org081471c">
<div class="org-src-container">
<pre class="src src-sql">  <span style="font-weight: bold;">SELECT</span>
    category,
    <span style="font-weight: bold;">count</span>(*) OVER (PARTITION <span style="font-weight: bold;">BY</span> category) <span style="font-weight: bold;">as</span> category_count,
    <span style="font-weight: bold;">count</span>(*) OVER () <span style="font-weight: bold;">as</span> total_count
  <span style="font-weight: bold;">FROM</span> posts
  <span style="font-weight: bold;">ORDER</span> <span style="font-weight: bold;">BY</span> category;
</pre>
</div>

<p>
will output both the count for each category, and the total amount of rows:
</p>
<div class="org-src-container">
<pre class="src src-text">   category | category_count | total_count
  ----------+----------------+------------
          1 |              2 |          3
          1 |              2 |          3
          3 |              1 |          3
</pre>
</div>

<p>
you can also define aliases for the window frames.
</p>

<div class="org-src-container">
<pre class="src src-sql">  <span style="font-weight: bold;">SELECT</span>
    category,
    <span style="font-weight: bold;">count</span>(*) OVER (w1) <span style="font-weight: bold;">as</span> category_count,
    <span style="font-weight: bold;">count</span>(*) OVER (w2) <span style="font-weight: bold;">as</span> total_count
  <span style="font-weight: bold;">FROM</span> posts
  WINDOW
    w1 <span style="font-weight: bold;">as</span> (PARTITION <span style="font-weight: bold;">BY</span> category),
    w2 <span style="font-weight: bold;">as</span> ()
  <span style="font-weight: bold;">ORDER</span> <span style="font-weight: bold;">BY</span> category;
</pre>
</div>
</div>
</div>
<div id="outline-container-org070a574" class="outline-2">
<h2 id="org070a574">Introducing some useful functions</h2>
<div class="outline-text-2" id="text-org070a574">
</div>
<div id="outline-container-orgb5c6e15" class="outline-3">
<h3 id="orgb5c6e15"><code>ROW_NUMBER</code></h3>
<div class="outline-text-3" id="text-orgb5c6e15">
<div class="org-src-container">
<pre class="src src-sql">  <span style="font-weight: bold;">SELECT</span>
    category,
    row_number() OVER (PARTITION <span style="font-weight: bold;">BY</span> category) <span style="font-weight: bold;">as</span> category_count,
    <span style="font-weight: bold;">count</span>(*) OVER () <span style="font-weight: bold;">as</span> total_count
  <span style="font-weight: bold;">FROM</span> posts
  <span style="font-weight: bold;">ORDER</span> <span style="font-weight: bold;">BY</span> category;
</pre>
</div>
</div>
</div>
<div id="outline-container-org78e6147" class="outline-3">
<h3 id="org78e6147"><code>LEAD</code></h3>
<div class="outline-text-3" id="text-org78e6147">
<p>
The <code>LEAD()</code> function is used to retrieve data from the next row.
</p>
</div>
</div>
<div id="outline-container-org9938051" class="outline-3">
<h3 id="org9938051"><code>LAG</code></h3>
<div class="outline-text-3" id="text-org9938051">
<p>
The <code>LAG()</code> function is used to retrieve data from the previous row.
</p>
</div>
</div>
<div id="outline-container-orga9cdf17" class="outline-3">
<h3 id="orga9cdf17"><code>ORDER BY</code></h3>
</div>

<div id="outline-container-orgaa3ae25" class="outline-3">
<h3 id="orgaa3ae25"><code>FIRST_VALUE()</code> and <code>LAST_VALUE()</code></h3>
</div>

<div id="outline-container-orgd914ca4" class="outline-3">
<h3 id="orgd914ca4"><code>RANK</code></h3>
</div>

<div id="outline-container-org54c8e3f" class="outline-3">
<h3 id="org54c8e3f"><code>DENSE_RANK</code></h3>
</div>

<div id="outline-container-orgc459384" class="outline-3">
<h3 id="orgc459384"><code>CUME_DIST</code></h3>
<div class="outline-text-3" id="text-orgc459384">
<blockquote>
<p>
The <code>CUME_DIST</code> function computes the fraction of partition rows that are less
than or equal to the current row and its peers.
(<a href="#citeproc_bib_item_1">Ferrari and Pirozzi 2023, 165</a>)
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-sql">  <span style="font-weight: bold;">SELECT</span>
    x,
    CUME_DIST() OVER w 
  <span style="font-weight: bold;">FROM</span> (<span style="font-weight: bold;">SELECT</span> generate_series(1,10) <span style="font-weight: bold;">AS</span> x)
  WINDOW w <span style="font-weight: bold;">AS</span> (<span style="font-weight: bold;">ORDER</span> <span style="font-weight: bold;">BY</span> x);

  <span style="font-weight: bold; font-style: italic;">-- </span><span style="font-weight: bold; font-style: italic;">Outputs:</span>
   x  | cume_dist 
  <span style="font-weight: bold; font-style: italic;">----</span><span style="font-weight: bold; font-style: italic;">+-----------</span>
    1 |       0.1
    2 |       0.2
    3 |       0.3
    4 |       0.4
    5 |       0.5
    6 |       0.6
    7 |       0.7
    8 |       0.8
    9 |       0.9
   10 |         1
</pre>
</div>
</div>
</div>
<div id="outline-container-orgedeb0f1" class="outline-3">
<h3 id="orgedeb0f1"><code>NTILE</code></h3>
</div>
</div>
<div id="outline-container-org50c3f37" class="outline-2">
<h2 id="org50c3f37">Using Advanced Statement Window Functions</h2>
</div>

<div id="outline-container-org95c4e48" class="outline-2">
<h2 id="org95c4e48">Value Functions</h2>
</div>

<div id="outline-container-org4b36d49" class="outline-2">
<h2 id="org4b36d49">References:</h2>
<div class="outline-text-2" id="text-org4b36d49">
<style>.csl-entry{text-indent: -1.5em; margin-left: 1.5em;}</style><div class="csl-bib-body">
  <div class="csl-entry"><a id="citeproc_bib_item_1"></a>Ferrari, Luca, and Enrico Pirozzi. 2023. <i>Learn Postgresql: Use, Manage, and Build Secure and Scalable Databases with Postgresql 16</i>. 2nd ed. Packt Publishing Ltd.</div>
</div>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1" role="doc-backlink">1</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
Source: <a href="https://www.postgresql.org/docs/current/tutorial-window.html">PostgreSQL Docs</a>
</p></div></div>


</div>
</div></main>
<footer id="postamble" class="status">
<footer>
  </br>
  <p>
  Built with <a href="https://orgmode.org/">Orgmode</a>, <a href="https://www.gnu.org/software/emacs/">Emacs</a> and <a href="https://nixos.org/">Nix</a>, source code availiable <a href="https://github.com/schonfinkel/schonfinkel.github.io">here</a>.
  </p>
</footer>
</footer>
</body>
</html>
