<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2024-12-30 Mon 12:48 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>How to use private NeoVim plugins on NixOS</title>
<meta name="author" content="Marcos Benevides" />
<meta name="generator" content="Org Mode" />
<link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
<!-- syntax highlighting -->
<link rel="stylesheet" href="https://unpkg.com/@highlightjs/cdn-assets@11.9.0/styles/default.min.css">
<script src="https://unpkg.com/@highlightjs/cdn-assets@11.9.0/highlight.min.js"></script>
<script src="https://unpkg.com/@highlightjs/cdn-assets@11.9.0/languages/erlang.min.js"></script>
<script src="https://unpkg.com/@highlightjs/cdn-assets@11.9.0/languages/fsharp.min.js"></script>
<script src="https://unpkg.com/@highlightjs/cdn-assets@11.9.0/languages/nix.min.js"></script>
<script src="https://unpkg.com/@highlightjs/cdn-assets@11.9.0/languages/yaml.min.js"></script>
<!-- D3.js for the Org-roam graph -->
<script type="text/javascript" src ="https://d3js.org/d3.v7.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.9.0/d3.min.js"></script>
<!-- For LaTeX -->
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<link href="https://schonfinkel.github.io/static/css/main.css" rel="stylesheet">
<script>
  MathJax = {
    tex: {
      displayMath: [['\\[', '\\]'], ['$$', '$$']],  // block
      inlineMath: [['\\(', '\\)']]                  // inline
    }
  };
</script>
</head>
<body>
<header id="preamble" class="status">
<nav>
  <img
    src="https://schonfinkel.github.io/static/img/logo.png"
    alt="logo"
    width="128"
    height="128"
  />
  <div>
    <h3>"Writing is nothing more than a guided dream."</h3>
  </div>
  <ul>
    <li><a href="https://schonfinkel.github.io/index.html">Home</a></li>
    <li><a href="https://schonfinkel.github.io/blog.html">Blog</a></li>
    <li><a href="https://schonfinkel.github.io/notes.html">Notes</a></li>
    <li><a href="https://schonfinkel.github.io/static/blogroll.xml">BlogRoll</a></li>
    <li><a href="https://schonfinkel.github.io/rss.html"><i class='bx bx-rss'></i></a></li>
  </ul>
</nav>
</header>
<main id="content" class="content">
<header>
<h1 class="title">How to use private NeoVim plugins on NixOS</h1>
<p class="subtitle" role="doc-subtitle">Some notes for myself, mostly</p>
</header><p>
Over time my config changed a lot since the early days, as of now I'm using a
combination of <a href="https://nixos.wiki/wiki/Flakes">Flakes</a> and <a href="https://github.com/nix-community/home-manager">home-manager</a> to manage my workstations. I try not to overthink
too much when it comes to Nix, my current Neovim setup is pretty simple, lua-based, yet,
fully nixified.
</p>

<div class="org-src-container">
<pre class="src src-shell">  dotfiles
  &#9500;&#9472;&#9472; (...)
  &#9500;&#9472;&#9472; nvim
  &#9474;   &#9500;&#9472;&#9472; files.lua
  &#9474;   &#9500;&#9472;&#9472; line.lua
  &#9474;   &#9500;&#9472;&#9472; lsp.lua
  &#9474;   &#9500;&#9472;&#9472; settings.lua
  &#9474;   &#9500;&#9472;&#9472; tabs.lua
  &#9474;   &#9492;&#9472;&#9472; treesitter.lua
  &#9500;&#9472;&#9472; (...)
  &#9492;&#9472;&#9472; zsh
  &#9492;&#9472;&#9472; zshrc
</pre>
</div>

<p>
I do it by having a simple directory where all my Neovim derivations stand.
</p>

<div class="org-src-container">
<pre class="src src-shell">  home
  &#9500;&#9472;&#9472; (...)
  &#9500;&#9472;&#9472; development
  &#9474;   &#9500;&#9472;&#9472; cloud.nix
  &#9474;   &#9500;&#9472;&#9472; default.nix
  &#9474;   &#9500;&#9472;&#9472; git.nix
  &#9474;   &#9500;&#9472;&#9472; iac.nix
  &#9474;   &#9500;&#9472;&#9472; kubernetes.nix
  &#9474;   &#9492;&#9472;&#9472; programming.nix
  &#9500;&#9472;&#9472; editors.nix
  &#9500;&#9472;&#9472; (...)
  &#9500;&#9472;&#9472; neovim
  &#9474;   &#9500;&#9472;&#9472; default.nix
  &#9474;   &#9500;&#9472;&#9472; packages.nix
  &#9474;   &#9492;&#9472;&#9472; private.nix
  &#9500;&#9472;&#9472; (...)
  &#9492;&#9472;&#9472; zshell.nix
</pre>
</div>

<p>
here's an example of what a <code>private.nix</code> file would look like, this is useful
when you want to use some package that's not available yet into <a href="https://github.com/NixOS/nixpkgs">nixpkgs</a>.
</p>

<div class="org-src-container">
<pre class="src src-nix">  { pkgs, config }:

  let
    plugin = pkgs.vimUtils.buildVimPlugin;
  in
  {
    vim-taskjuggler = plugin {
      name = "vim-taskjuggler";
      src = pkgs.fetchFromGitHub {
        owner = "kalafut";
        repo = "vim-taskjuggler";
        rev = "e94c9a0b06022d11a34310ad5f82c1c2bcd86fb7";
        sha256 = "0f8smjl6wi52p8n1hhl5zhk8i3lpsfndxxdammyybw2vz17s0j8q";
      };
    };
  }
</pre>
</div>
<p>
then you can just import it from other files:
</p>
<div class="org-src-container">
<pre class="src src-nix">  { pkgs, config, lib, ... }:

  let
    plugins = pkgs.vimPlugins;
    private = import ./private.nix { inherit pkgs config; };
  in
  {
    base = with plugins; [
      nvim-surround
      vim-which-key
      vim-visual-multi
      hologram-nvim
    ];
    eyecandy = with plugins // private; [
      kanagawa-nvim
      nvim-colorizer-lua
      nvim-cursorline
      nvim-web-devicons
      tokyonight-nvim
    ];
    ui = with plugins; [
      # File Tree
      nvim-tree-lua
      # Find/Filter
      plenary-nvim
      telescope-nvim
      # Status Line
      lualine-nvim
      # Tabs
      barbar-nvim
    ];
    lsp = with plugins // private; [
      nvim-cmp
      nvim-lspconfig
      (nvim-treesitter.withPlugins (p:
        [
          p.c
          p.bash
          p.dockerfile
          p.gitignore
          p.lua
          p.markdown
          p.nix
          p.proto
          p.scheme
          p.sql
          p.terraform
          p.yaml
        ]
      ))
      # Snippets
      luasnip
      cmp-git
      # CMP Plugins
      cmp-cmdline
      cmp_luasnip
      cmp-nvim-lsp
      cmp-path
      cmp-treesitter
    ];
    tooling = with plugins; [
      direnv-vim
      Ionide-vim
      vim-nix
      vim-terraform
    ];
  }
</pre>
</div>

<p>
and <a href="https://nix-community.github.io/home-manager/options.html#opt-programs.neovim.enable">since Neovim has an awesome module in home-manager</a>, make sure to use it:
</p>
<div class="org-src-container">
<pre class="src src-nix">  programs.neovim = {
    enable = true;

    # (...)
    plugins = vimPlugins.base ++ vimPlugins.eyecandy ++ vimPlugins.ui ++ vimPlugins.lsp ++ vimPlugins.tooling;
  };
</pre>
</div>

<p>
If you want to see an up-to-date version of these dotfiles, feel free to <del>steal</del>
take a look <a href="https://github.com/mtrsk/nixos-config/tree/master/home/neovim">here</a>.
</p>
</main>
<footer id="postamble" class="status">
<footer>
  </br>
  <p>
  Built with <a href="https://orgmode.org/">Orgmode</a>, <a href="https://www.gnu.org/software/emacs/">Emacs</a> and <a href="https://nixos.org/">Nix</a>, source code availiable <a href="https://github.com/mtrsk/mtrsk.github.io">here</a>.
  </p>
</footer>
</footer>
</body>
</html>
